name: Translate README

on:
  workflow_dispatch:

jobs:
  translate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # Remove old translations so they regenerate
      - name: Remove old translated READMEs
        run: |
          rm -f README.fr.md README.ru.md README.es.md
          rm -rf languages
          mkdir -p languages

      # Generate translations
      - name: Generate French README
        uses: dephraiim/translate-readme@main
        with:
          LANG: fr

      - name: Generate Russian README
        uses: dephraiim/translate-readme@main
        with:
          LANG: ru

      - name: Generate Spanish README
        uses: dephraiim/translate-readme@main
        with:
          LANG: es

      # Move translations into languages folder (overwrite safely)
      - name: Move translated READMEs
        run: |
          mv -f README.fr.md languages/README.fr.md
          mv -f README.ru.md languages/README.ru.md
          mv -f README.es.md languages/README.es.md

      # Git config
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      # Commit once
      - name: Commit and push changes
        run: |
          git add -A
          git commit -m "Update translated READMEs"
          git push
